!function(e){"use strict";e(function(){e.fn.center=function(){return this.css("top",Math.max(0,(e(window).height()-e(this).outerHeight())/2+e(window).scrollTop())+"px"),this.css("left",Math.max(0,(e(window).width()-e(this).outerWidth())/2+e(window).scrollLeft())+"px"),this};var t=function(){e("html, body").animate({scrollTop:e("#masthead").offset().top},100)};_.templateSettings={evaluate:/\{\[([\s\S]+?)\]\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g};var n={};_.extend(n,Backbone.Events);{var o=Backbone.View.extend({el:"#content",initialize:function(){},fetchPosts:function(e){var t=this;this.collection=new wp.api.collections.Posts,this.collection.fetch({data:{page:e},success:function(n,o,i){t.totalPages=i.xhr.getResponseHeader("X-WP-TotalPages"),t.total=i.xhr.getResponseHeader("X-WP-Total"),t.currentPage=e,t.render()}})},render:function(){var n=e("#home-view").html();n=_.template(n);var o={posts:this.collection.models,pages:this.totalPages,total:this.total,currentPage:this.currentPage},n=n(o);e(this.el).html(n),t()}}),i=Backbone.View.extend({el:"#content",initialize:function(){},events:{"submit #commentform":"submitComment"},submitComment:function(t){t.preventDefault();var n=this,o=!1,i=e(t.currentTarget),s=i.find("textarea#comment").val();i.find(".error").remove();var a=[".comment-form-author",".comment-form-email",".comment-form-comment"];if(e.each(a,function(t,n){e(n).removeClass("invalid")}),"no"===wedevsBackbone.loggedin){var l=i.find("input#email").val(),r=i.find("input#author").val();""===r&&(o=!0,i.find(".comment-form-author").addClass("invalid").append('<div class="error">Error: please type a comment.</div>')),""===l&&(o=!0,i.find(".comment-form-email").addClass("invalid").append('<div class="error">Error: please type a comment.</div>'))}if(""===s&&(o=!0,i.find(".comment-form-comment").addClass("invalid").append('<div class="error">Error: please type a comment.</div>')),!o){var m=i.serialize()+"&action=wpbb_new_comment";e.post(wedevsBackbone.ajaxurl,m,function(e){e.success===!1?alert(e.data):(new c).initComments(n.model)})}},fetchPost:function(e,t){var n=this;n.type=t,this.model=new wp.api.models.Post({ID:e}),this.model.fetch({success:function(){n.render()}})},render:function(){if("post"===this.type)var o=e("#single-post-view").html();else var o=e("#single-page-view").html();var o=_.template(o),i={post:this.model},o=o(i);e(this.el).html(o),n.trigger("post:single:"+this.type,this.model),t()}}),s=Backbone.Model.extend({idAttribute:"ID",defaults:{ID:0,post:0,contnt:"",parent:0,date:"",links:{},author:{name:"",URL:"",avatar:""}}}),a=Backbone.Collection.extend({model:s,url:function(){return WP_API_Settings.root+"/posts/"+this.post.id+"/comments"},comparator:function(e){return e.get("date")},initialize:function(e){this.post=e}}),c=Backbone.View.extend({initialize:function(){this.el="#comments",n.once("post:single:post",this.initComments,this)},initComments:function(e){var t=this;t.post=e,this.collection=new a(e),this.collection.fetch({success:function(){t.render()}})},render:function(){var t=e("#comments-view").html(),t=_.template(t),n={comments:this.collection.models,post:this.post},t=t(n);e(this.el).html(t)}}),l=Backbone.Router.extend({routes:{"/":"home","posts/:id/*slug":"singlePost","page/:id/*slug":"singlePage","page/:id/*slug/*slug":"singlePage","p/:id":"paged","*actions":"home"},singlePost:function(e){(new i).fetchPost(e,"post"),new c},singlePage:function(e){(new i).fetchPost(e,"page")},home:function(){(new o).fetchPosts(1)},paged:function(e){(new o).fetchPosts(e)}});new l}Backbone.history.start(),e(".loading").center(),e.ajaxSetup({beforeSend:function(){e(".loading").show()},complete:function(){e(".loading").hide()}})})}(jQuery);